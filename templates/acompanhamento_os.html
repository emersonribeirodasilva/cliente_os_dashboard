<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento de OS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Container da tabela */
        .table-container {
            max-height: 700px;
            min-width: 600px;
            overflow-y: auto;
            border: 3px solid #ccc;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Cabe√ßalho fixo */
        thead th {
            position: sticky;
            top: 0;
            background-color: #f8f9fa;
            z-index: 2;
        }

        /* Input de filtro */
        .filter-input {
            width: 100%;
            font-size: 12px;
            padding: 2px;
            margin-top: 2px;
        }

        /* Bot√µes na mesma linha */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        /* Bot√£o voltar */
        .btn-back {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <h1 class="text-center mb-3">Acompanhamento de Ordens de Servi√ßo</h1>

    <!-- üîç Busca global -->
    <input type="text" id="globalSearch" class="form-control mb-3" placeholder="Pesquisar tudo...">

    <!-- Tabela -->
    <div class="table-container">
        <table class="table table-striped table-bordered" id="osTable">
            <thead class="thead-light">
                <tr>
                    <th>ID<br><input class="filter-input" data-col="0" placeholder="Filtrar ID"></th>
                    <th>ID Cliente<br><input class="filter-input" data-col="1" placeholder="Filtrar Cliente"></th>
                    <th>ID Equip<br><input class="filter-input" data-col="2" placeholder="Filtrar Equip"></th>
                    <th>Descri√ß√£o<br><input class="filter-input" data-col="3" placeholder="Filtrar Descri√ß√£o"></th>
                    <th>Status<br><input class="filter-input" data-col="4" placeholder="Filtrar Status"></th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for ordem in ordens_servico %}
                <tr class="
                    {% if ordem['status'] == 'Finalizado' %}table-primary
                    {% elif ordem['status'] == 'Em Andamento' %}table-warning
                    {% elif ordem['status'] == 'Exclu√≠do' %}table-danger
                    {% endif %}
                ">
                    <td>{{ ordem["id"] }}</td>
                    <td>{{ ordem["cliente_id"] }}</td>
                    <td>{{ ordem["equipamento_id"] }}</td>
                    <td>{{ ordem["descricao"] }}</td>
                    <td>{{ ordem["status"] }}</td>
                    <td>
                        <div class="action-buttons">
                            <form action="{{ url_for('editar_os', os_id=ordem['id']) }}" method="get">
                                <button class="btn btn-secondary btn-sm">EDITAR</button>
                            </form>
                            <form action="{{ url_for('excluir_os', os_id=ordem['id']) }}" method="post">
                                <button class="btn btn-danger btn-sm">EXCLUIR</button>
                            </form>
                            <form action="{{ url_for('finalizar_os', os_id=ordem['id']) }}" method="post">
                                <button class="btn btn-success btn-sm">FINALIZAR</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <button class="btn btn-primary btn-block btn-back" onclick="window.history.back()">Voltar</button>
</div>

<script>
    // üîç Busca global
    document.getElementById("globalSearch").addEventListener("keyup", function() {
        let value = this.value.toLowerCase();
        let rows = document.querySelectorAll("#osTable tbody tr");
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(value) ? "" : "none";
        });
    });

    // üîé Filtro por coluna
    document.querySelectorAll(".filter-input").forEach(input => {
        input.addEventListener("keyup", function() {
            let colIndex = this.getAttribute("data-col");
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll("#osTable tbody tr");
            rows.forEach(row => {
                let cell = row.querySelectorAll("td")[colIndex];
                if (cell) {
                    let text = cell.innerText.toLowerCase();
                    row.style.display = text.includes(filter) ? "" : "none";
                }
            });
        });
    });
</script>

</body>
</html>
