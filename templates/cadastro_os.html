<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cadastro O.S. / Empresa Compradora</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="container mt-4">
    <h3 class="mb-4">Cadastro de Ordem de Serviço / Empresa Compradora</h3>

    <ul class="nav nav-tabs" id="osTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link {% if active_tab != 'empresa' %}active{% endif %}" id="os-tab" data-toggle="tab" href="#tab-os" role="tab">1. Cadastro O.S.</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if active_tab == 'empresa' %}active{% endif %}" id="empresa-tab" data-toggle="tab" href="#tab-empresa" role="tab">2. Empresa Compradora</a>
        </li>
    </ul>

    <form method="POST" class="mt-3">
        <div class="tab-content">
            <div class="tab-pane fade {% if active_tab != 'empresa' %}show active{% endif %}" id="tab-os" role="tabpanel">
                <div class="form-group">
                    <label for="cliente_id">Cliente</label>
                    <select id="cliente_id" name="cliente_id" class="form-control">
                        <option value="">-- Selecionar cliente --</option>
                        {% for c in clientes %}
                        <option value="{{ c['id'] }}">{{ c['nome'] }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="equipamento_id">Equipamento (opcional)</label>
                    <select id="equipamento_id" name="equipamento_id" class="form-control">
                        <option value="">-- Selecionar equipamento --</option>
                        {% for e in equipamentos %}
                        <option value="{{ e['id'] }}">{{ e['modelo'] }} - {{ e['marca'] }} {% if e['status'] %}({{ e['status'] }}){% endif %}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="descricao">Descrição do Problema</label>
                    <textarea id="descricao" name="descricao" class="form-control" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label for="status">Status</label>
                    <select id="status" name="status" class="form-control">
                        <option value="Aberto">Aberto</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Finalizado">Finalizado</option> 
                    </select>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" name="action" value="save_os" class="btn btn-primary">Salvar O.S.</button>
                     <button type="button" class="btn btn-secondary btn-block" onclick="window.history.back();">Sair</button>
                   
                </div>
            </div>

            <div class="tab-pane fade {% if active_tab == 'empresa' %}show active{% endif %}" id="tab-empresa" role="tabpanel">
                <div class="form-group">
                    <label for="nome">Nome da Empresa</label>
                    <input id="nome" name="nome" class="form-control" required>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="cnpj">CNPJ</label>
                        <input id="cnpj" name="cnpj" class="form-control">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="contato">Contato</label>
                        <input id="contato" name="contato" class="form-control">
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">E-mail</label>
                    <input id="email" name="email" class="form-control" type="email">
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label for="telefone">Telefone</label>
                        <input id="telefone" name="telefone" class="form-control">
                    </div>
                    <div class="form-group col-md-6">
                        <label for="endereco">Endereço</label>
                        <input id="endereco" name="endereco" class="form-control">
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" name="action" value="save_empresa" class="btn btn-primary">Salvar Empresa Compradora</button>
                    <button type="button" class="btn btn-secondary btn-block" onclick="window.history.back();">Sair</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>
    // mantém aba ativa ao carregar via query param (server já marca active_tab)
    // opcional: ativar aba correspondente ao clicar
    $('#osTabs a').on('click', function (e) {
      e.preventDefault()
      $(this).tab('show')
    })
</script>
</body>
</html>
